generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Member {
  id                  String   @id @default(uuid())
  name                String
  department          String?
  position            String?
  meetingIntervalDays Int      @default(14)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  meetings    Meeting[]
  actionItems ActionItem[]
}

model Meeting {
  id        String   @id @default(uuid())
  memberId  String
  date      DateTime
  mood      Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  member      Member       @relation(fields: [memberId], references: [id], onDelete: Cascade)
  topics      Topic[]
  actionItems ActionItem[]

  @@index([memberId])
}

model Topic {
  id        String        @id @default(uuid())
  meetingId String
  category  TopicCategory
  title     String
  notes     String        @default("")
  sortOrder Int           @default(0)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  meeting Meeting    @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  tags    TopicTag[]

  @@index([meetingId])
  @@index([meetingId, sortOrder])
}

enum TopicCategory {
  WORK_PROGRESS
  CAREER
  ISSUES
  FEEDBACK
  OTHER
}

model ActionItem {
  id          String           @id @default(uuid())
  meetingId   String
  memberId    String
  title       String
  description String           @default("")
  status      ActionItemStatus @default(TODO)
  sortOrder   Int              @default(0)
  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  meeting Meeting         @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  member  Member          @relation(fields: [memberId], references: [id], onDelete: Cascade)
  tags    ActionItemTag[]

  @@index([meetingId])
  @@index([meetingId, sortOrder])
  @@index([memberId])
  @@index([memberId, status])
  @@index([status])
}

enum ActionItemStatus {
  TODO
  IN_PROGRESS
  DONE
}

model Tag {
  id        String   @id @default(uuid())
  name      String   @unique
  color     String   @default("#6366f1")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  topics      TopicTag[]
  actionItems ActionItemTag[]
}

model TopicTag {
  topicId String
  tagId   String

  topic Topic @relation(fields: [topicId], references: [id], onDelete: Cascade)
  tag   Tag   @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([topicId, tagId])
  @@index([tagId])
}

model ActionItemTag {
  actionItemId String
  tagId        String

  actionItem ActionItem @relation(fields: [actionItemId], references: [id], onDelete: Cascade)
  tag        Tag        @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([actionItemId, tagId])
  @@index([tagId])
}
