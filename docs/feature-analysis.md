# Nudge 機能分析・改善提案書

## 1. 現状の機能分析

### 1.1 アプリケーション概要

Nudge は 1on1 ミーティングの記録・管理を行うシングルユーザー向けローカル Web アプリケーション。Next.js 16 (App Router) + React 19 + Prisma (SQLite) で構成され、メンバー管理、ミーティング記録、アクションアイテム管理を核とした機能を提供している。

### 1.2 現在実装されている機能

| 機能カテゴリ | 機能 | 概要 |
| --- | --- | --- |
| **ダッシュボード** | KPI カード | 要フォロー人数、アクション完了率、今月の1on1回数、期限超過件数を表示 |
| | メンバー一覧テーブル | ソート可能（最終1on1、未完了アクション数）、ステータスバッジ（良好/注意/要フォロー）付き |
| **メンバー管理** | CRUD | 名前（必須）、部署、役職の登録・更新・削除 |
| | メンバー詳細 | アバター表示、1on1 履歴一覧、アクションアイテム一覧 |
| **ミーティング管理** | 新規作成 | 日付、話題（カテゴリ + タイトル + ノート）、アクションアイテムを一括登録 |
| | 準備画面 | 前回のミーティング振り返り、未完了アクション確認、テンプレート選択、アジェンダ作成 |
| | ミーティング詳細 | 話題・アクションアイテムの閲覧 |
| | テンプレート | 定期チェックイン、キャリア面談、課題解決、フリーの4種 |
| | ドラッグ&ドロップ | 話題の並び替え（dnd-kit、`sortOrder` で永続化）。アクションアイテムはフォーム内のみ並び替え可能（順序は DB 未永続化） |
| **アクションアイテム** | ステータス管理 | TODO / IN_PROGRESS / DONE のステータス遷移（クリックでサイクル、ドロップダウンで選択） |
| | フィルタリング | ステータス別、メンバー別のフィルタリング |
| | 期限管理 | 期限日の設定、期限超過の検出・表示 |
| **UI/UX** | レスポンシブ | デスクトップ固定サイドバー、モバイルハンバーガーメニュー |
| | パンくずリスト | 全ページに階層ナビゲーション |
| | アニメーション | フェードイン、スライドイン等のマイクロインタラクション |
| | アバター | 名前からイニシャル + 決定論的グラデーション生成 |

### 1.3 データモデル

```
Member (1) ──< (N) Meeting (1) ──< (N) Topic
   │                    │
   │                    └──< (N) ActionItem
   └──────────────────────────< (N) ActionItem
```

- **Member**: 名前、部署、役職
- **Meeting**: 日付、メンバー紐付け
- **Topic**: カテゴリ（5種）、タイトル、ノート、表示順
- **ActionItem**: タイトル、説明、ステータス（3種）、期限日、完了日

### 1.4 現状の強み

- **準備 → 記録の流れ**: ミーティング準備画面で前回の振り返り・未完了アクション確認 → テンプレート選択 → アジェンダ作成 → 記録というワークフローが確立されている
- **即時フィードバック**: KPI ダッシュボードで要フォロー状態・期限超過を一目で把握可能
- **シンプルな操作性**: アクションアイテムのステータスをワンクリックで変更できる
- **ドラッグ&ドロップ**: 話題の直感的な並び替え（`sortOrder` で永続化済み）

### 1.5 現状の課題

コードベースの調査により、以下の課題・不整合が確認された。

| # | 課題 | 詳細 | 関連セクション |
| --- | --- | --- | --- |
| 1 | **ActionItem の並び順が未永続化** | フォーム上では dnd-kit による並び替え UI が存在するが、`ActionItem` モデルに `sortOrder` フィールドがなく、DB には順序が保存されない。保存後は `dueDate asc, createdAt desc` で表示される | 2.1.3 |
| 2 | **ミーティング編集不可** | 作成後の修正・追記ができない。`updateMeeting` Server Action が存在しない | 2.1.1 |
| 3 | **メンバー編集 UI の欠如** | `updateMember` Server Action は実装済みだが、呼び出す UI が存在しない | 2.1.2 |
| 4 | **サイレントエラー** | 一部の Server Action で `catch` ブロックがエラーを握りつぶしており、ユーザーにフィードバックがない | 2.5.2 |
| 5 | **エラー境界が未設定** | `error.tsx` / `not-found.tsx` がなく、ランタイムエラー時のフォールバック UI がない | 2.5.2 |
| 6 | **操作フィードバックの不足** | トースト通知等がなく、保存成功・失敗のフィードバックが `router.push` によるページ遷移のみ | 2.3.3 |

---

## 2. 改善提案

### 2.1 データ管理の改善

#### 2.1.1 ミーティングの編集機能

**優先度: 高**

現状はミーティング作成後の編集ができない。記録直後の修正や、後からノートを追加する運用が不可能。

**提案内容:**

- ミーティング詳細画面に「編集」ボタンを追加
- 話題の追加・削除・内容修正、アクションアイテムの追加・削除・内容修正を可能に
- `updateMeeting` Server Action と `updateMeetingSchema` バリデーションの追加
- 話題のノートはミーティング中にリアルタイムで更新する使い方が多いため、インライン編集を推奨

**影響範囲:**

- `src/lib/actions/meeting-actions.ts` — `updateMeeting` 関数の追加
- `src/lib/validations/meeting.ts` — `updateMeetingSchema` の追加
- `src/components/meeting/meeting-detail.tsx` — 編集モードの追加
- `src/app/members/[id]/meetings/[meetingId]/page.tsx` — 編集 UI の統合

#### 2.1.2 メンバーの編集機能

**優先度: 高**

`updateMember` Server Action は存在するが、UI 上でメンバー情報を編集する画面がない。

**提案内容:**

- メンバー詳細画面に「編集」ボタンを追加
- メンバーフォームを新規登録と編集で共用化（`initialData` prop 追加）
- 部署変更や役職変更を UI から実行可能に

**影響範囲:**

- `src/components/member/member-form.tsx` — 編集モード対応
- `src/app/members/[id]/page.tsx` — 編集ダイアログ or ページの追加

#### 2.1.3 アクションアイテムの編集機能

**優先度: 中**

現状はステータスの変更のみ可能。タイトル・説明・期限の修正ができない。

**提案内容:**

- アクションアイテムのインライン編集またはモーダル編集
- `updateActionItem` Server Action の追加
- 期限の変更、説明の追記を可能に

#### 2.1.4 ミーティングの削除確認

**優先度: 中**

`deleteMeeting` は実装済みだが、UI 上に削除ボタン・確認ダイアログがない。

**提案内容:**

- ミーティング詳細画面に「削除」ボタンを追加
- 確認ダイアログ（shadcn/ui の AlertDialog）を使用して誤削除を防止
- メンバー削除も同様の確認ダイアログを追加

---

### 2.2 分析・可視化機能

#### 2.2.1 ミーティング頻度の可視化

**優先度: 中**

**提案内容:**

- メンバー別の1on1実施間隔をヒートマップまたはカレンダービューで表示
- 月ごとの実施回数のバーチャート（lightweight なライブラリとして Recharts を推奨）
- ダッシュボードに「推奨: 今週1on1すべきメンバー」のレコメンド表示

**実装方針:**

- 新規ページ `src/app/analytics/page.tsx` の追加
- `getDashboardSummary` を拡張してトレンドデータ（過去3ヶ月分）を返却
- CSS Grid ベースの月間カレンダー or 軽量チャートライブラリの導入

#### 2.2.2 話題カテゴリの傾向分析

**優先度: 低**

**提案内容:**

- メンバーごとに話題カテゴリの分布を円グラフまたはバーチャートで表示
- 「キャリア相談が少ない」「課題ばかり」などの偏りを可視化
- 時系列での話題カテゴリ変遷

#### 2.2.3 アクションアイテムの完了傾向

**優先度: 低**

**提案内容:**

- メンバー別のアクション完了率推移のライングラフ
- 平均完了日数の表示
- 期限遵守率の可視化

---

### 2.3 ユーザビリティ改善

#### 2.3.1 検索機能

**優先度: 高**

**提案内容:**

- グローバル検索バー（サイドバーまたはヘッダーに配置）
- 検索対象: メンバー名、話題タイトル、話題ノート、アクションアイテムタイトル
- SQLite の LIKE ベースでの全文検索（FTS5 はスコープ外）
- `Cmd+K` / `Ctrl+K` ショートカットでフォーカス
- インクリメンタル検索結果をドロップダウンで表示

**実装方針:**

- `src/lib/actions/search-actions.ts` — `search(query: string)` 関数
- `src/components/layout/search-dialog.tsx` — Dialog コンポーネント
- 各モデルを横断的に検索し、カテゴリ別に結果をグループ化

#### 2.3.2 キーボードショートカット

**優先度: 低**

**提案内容:**

- `n` — 新規メンバー追加
- `m` — 新規ミーティング作成（メンバー選択付き）
- `Cmd+K` — 検索
- `?` — ショートカット一覧表示

#### 2.3.3 トースト通知

**優先度: 中**

**提案内容:**

- ミーティング保存成功、アクション完了などの操作フィードバック
- shadcn/ui の `sonner` (toast) コンポーネントの導入
- 現在は `router.push` によるページ遷移のみでフィードバックが弱い

#### 2.3.4 空状態（Empty State）の改善

**優先度: 低**

**提案内容:**

- 各画面にイラストまたはアイコン付きの空状態メッセージ
- CTA（Call To Action）ボタンの強調
- 初回起動時のオンボーディング（メンバー登録 → 最初の1on1 記録への誘導）

---

### 2.4 新機能提案

#### 2.4.1 1on1 メモのリアルタイム記録モード

**優先度: 高**

**現状の課題:**

現在の MeetingForm はミーティング終了後に記録する「後書き」スタイル。ミーティング中にリアルタイムでノートを取る使い方に最適化されていない。

**提案内容:**

- ミーティング開始ボタンで「記録モード」に入る
- 話題ごとにノートをインライン入力
- 自動保存（debounce 500ms での定期保存、またはフォーカスアウト時保存）
- ミーティング終了ボタンで確定
- 所要時間の自動計測（開始〜終了）

**実装方針:**

- `Meeting` モデルに `startedAt`, `endedAt` フィールドを追加
- `src/components/meeting/meeting-live.tsx` — ライブ記録コンポーネント
- Server Action で話題ごとの部分更新（`updateTopicNotes`）
- ブラウザの `beforeunload` で未保存警告

#### 2.4.2 定期ミーティングスケジュール

**優先度: 中**

**提案内容:**

- メンバーごとに 1on1 の実施頻度（毎週 / 隔週 / 月1）を設定
- 次回推奨日の自動計算と表示
- ダッシュボードに「今週予定の1on1」セクションを追加

**実装方針:**

- `Member` モデルに `meetingFrequency` フィールド（`WEEKLY` / `BIWEEKLY` / `MONTHLY`）を追加
- 最終ミーティング日 + 頻度から次回推奨日を計算
- ダッシュボード KPI に「今週予定」カードを追加

#### 2.4.3 フィードバック / 感情トラッキング

**優先度: 中**

**提案内容:**

- ミーティング終了時に感情スコア（1〜5 の emoji スケール）を記録
- メンバーの感情推移をトレンドグラフで可視化
- メンタルヘルスの傾向把握に活用

**実装方針:**

- `Meeting` モデルに `mood` フィールド（Int, 1-5）を追加
- ミーティングフォームの最後に感情選択 UI を追加
- メンバー詳細画面にムードトレンドのスパークラインを表示

#### 2.4.4 タグ / ラベル機能

**優先度: 低**

**提案内容:**

- 話題やアクションアイテムにカスタムタグを付与
- タグによるフィルタリング・検索
- よく使うタグの自動サジェスト

**実装方針:**

- `Tag` モデルの追加（多対多リレーション）
- タグ入力コンポーネント（コンボボックス型）
- 検索・フィルタとの統合

#### 2.4.5 ミーティングノートのエクスポート

**優先度: 低**

**提案内容:**

- メンバーごとの1on1サマリーを Markdown / PDF でエクスポート
- 期間指定でのバルクエクスポート
- クリップボードへのコピー機能

**実装方針:**

- サーバーサイドで Markdown 文字列を生成
- `text/markdown` のダウンロードレスポンス
- PDF は `@react-pdf/renderer` で対応

#### 2.4.6 ミーティング実施リマインダー

**優先度: 低**

**提案内容:**

- 設定した頻度を超えてミーティング未実施のメンバーについて、ダッシュボードで目立つアラートを表示
- ブラウザ通知（Notification API）での通知（オプション）

**現状との比較:**

- 現在「要フォロー」バッジは14日間未実施で表示されるが、メンバーごとのカスタム設定はできない
- 提案ではメンバーごとの頻度設定と連動した精密なリマインダーを実現

---

### 2.5 技術的改善

#### 2.5.1 楽観的更新（Optimistic Updates）

**優先度: 高**

**現状の課題:**

アクションアイテムのステータス変更は `updateActionItemStatus` → `router.refresh()` のフローで、サーバー応答まで UI が変わらない。

**提案内容:**

- React 19 の `useOptimistic` フックを使用
- ステータス変更を即座に UI に反映し、サーバーエラー時にロールバック
- 操作の体感速度が大幅に向上

**影響範囲:**

- `src/components/action/action-list-compact.tsx`
- `src/components/action/action-list-full.tsx`
- `src/components/meeting/previous-meeting-sidebar.tsx`

#### 2.5.2 エラーハンドリングの統一

**優先度: 中**

**現状の課題:**

- 複数箇所で `catch { // Silently fail }` パターンが使われている
- ユーザーにエラーが伝わらない
- エラー境界（Error Boundary）が未設定

**提案内容:**

- `src/app/error.tsx` グローバルエラー境界の追加
- `src/app/not-found.tsx` カスタム 404 ページの追加
- トースト通知によるエラーフィードバック
- Server Action のエラーを型安全に返却する共通パターンの導入

```typescript
type ActionResult<T> =
  | { success: true; data: T }
  | { success: false; error: string };
```

#### 2.5.3 データベース最適化

**優先度: 低**

**提案内容:**

- `getMembers` で N+1 クエリのリスクがある箇所を Prisma の `include` で最適化（現状は概ね適切）
- インデックスの見直し（`Topic.meetingId` + `sortOrder` の複合インデックスなど）
- ページネーションの導入（メンバー数・ミーティング数が増加した場合の対策）

#### 2.5.4 テストカバレッジの拡充

**優先度: 中**

**現状の課題:**

- Server Actions のユニットテストは存在する
- コンポーネントテストは一部のみ（meeting-form, meeting-prepare, template-selector, member-list, dashboard-summary, sortable items）
- E2E テストが未導入

**提案内容:**

- 未テストコンポーネントのテスト追加（action-list-full, action-list-compact, action-filters, sidebar, breadcrumb）
- Playwright による E2E テストの導入（主要ユーザーフロー: メンバー登録 → ミーティング記録 → アクション管理）
- カバレッジの CI 自動測定

#### 2.5.5 アクセシビリティ改善

**優先度: 中**

**提案内容:**

- `action-list-compact.tsx` の `<button>` に適切な `aria-label` を追加
- `previous-meeting-sidebar.tsx` の `<input type="checkbox">` に `aria-label` 追加
- ドラッグ&ドロップ操作のキーボードアクセシビリティ向上（現在 `KeyboardSensor` は設定済みだが、スクリーンリーダー向けの説明が不足）
- カラーコントラストの WCAG 2.1 AA 準拠確認

#### 2.5.6 ダークモード対応

**優先度: 低**

**提案内容:**

- OKLch ベースの CSS 変数にダークテーマ値を追加
- `prefers-color-scheme` メディアクエリによる自動切替
- 手動切替トグルの追加（サイドバーのフッター領域）
- shadcn/ui はダークモード対応済みのため、CSS 変数の上書きのみで対応可能

---

### 2.6 UX フロー改善

#### 2.6.1 メンバー詳細画面の情報密度向上

**優先度: 中**

**提案内容:**

- 最終1on1からの経過日数を目立つ位置に表示
- 未完了アクションの件数バッジ
- 「クイックアクション」セクション（最近のアクションをその場で完了マーク可能）
- メンバーとの通算1on1回数の表示

#### 2.6.2 ダッシュボードの強化

**優先度: 中**

**提案内容:**

- 「最近のアクティビティ」タイムライン（直近の1on1記録、アクション完了のフィード）
- 「今日 / 今週のタスク」セクション（期限が近いアクションアイテム一覧）
- メンバーカードのクイックアクション（ダッシュボードから直接1on1を開始）

#### 2.6.3 ミーティング準備画面の改善

**優先度: 中**

**提案内容:**

- 前回のミーティングだけでなく、過去複数回のミーティングを参照可能に
- 前回の話題をワンクリックで今回のアジェンダにコピー
- アクションアイテムの進捗確認チェックリスト（準備画面で事前にステータスを更新可能）

---

## 3. 実装優先度マトリクス

| 優先度 | 機能 | カテゴリ | 理由 |
| --- | --- | --- | --- |
| **P0（必須）** | ミーティング編集 | データ管理 | 基本的な CRUD の欠損。記録後の修正不可は致命的 |
| **P0（必須）** | メンバー編集 UI | データ管理 | Server Action は実装済みだが UI がない |
| **P0（必須）** | 楽観的更新 | 技術改善 | React 19 の特長を活かし操作体感を向上 |
| **P1（重要）** | 検索機能 | UX | データ量増加に伴い必須となる |
| **P1（重要）** | トースト通知 | UX | 操作フィードバックの欠如を解消 |
| **P1（重要）** | エラーハンドリング統一 | 技術改善 | サイレントエラーの解消 |
| **P1（重要）** | リアルタイム記録モード | 新機能 | 1on1ツールとしての最大の差別化ポイント |
| **P1（重要）** | 削除確認ダイアログ | UX | 誤操作防止 |
| **P2（推奨）** | 定期スケジュール設定 | 新機能 | 運用の定着を促進 |
| **P2（推奨）** | 感情トラッキング | 新機能 | メンバーケアの質を向上 |
| **P2（推奨）** | ミーティング頻度の可視化 | 分析 | マネジメントの改善サイクルを支援 |
| **P2（推奨）** | アクションアイテム編集 | データ管理 | 運用上の利便性 |
| **P2（推奨）** | テストカバレッジ拡充 | 技術改善 | 品質の維持・向上 |
| **P2（推奨）** | アクセシビリティ改善 | 技術改善 | インクルーシブな設計 |
| **P2（推奨）** | ダッシュボード強化 | UX | 日常的な利用頻度を向上 |
| **P2（推奨）** | 準備画面の改善 | UX | 1on1 の質を向上 |
| **P3（将来）** | 話題カテゴリの傾向分析 | 分析 | データ蓄積後に有効 |
| **P3（将来）** | タグ / ラベル機能 | 新機能 | 情報整理の高度化 |
| **P3（将来）** | エクスポート機能 | 新機能 | 外部共有・バックアップ |
| **P3（将来）** | ダークモード | 技術改善 | ユーザー好みへの対応 |
| **P3（将来）** | ショートカットキー | UX | パワーユーザー向け |
| **P3（将来）** | 空状態の改善 | UX | 初回体験の向上 |
| **P3（将来）** | DB 最適化 | 技術改善 | スケール時に対応 |

---

## 4. 推奨する実装ロードマップ

### Phase 1: 基盤整備

- ミーティング編集機能
- メンバー編集 UI
- 削除確認ダイアログ
- エラーハンドリングの統一
- トースト通知の導入

### Phase 2: 操作性向上

- 楽観的更新の導入
- アクションアイテム編集
- 検索機能
- ダッシュボード強化

### Phase 3: 差別化機能

- リアルタイム記録モード
- 定期スケジュール設定
- 感情トラッキング
- ミーティング準備画面の改善

### Phase 4: 分析・拡張

- ミーティング頻度の可視化
- 話題カテゴリの傾向分析
- エクスポート機能
- ダークモード

---

## 5. 補足: 競合分析の観点

1on1 ツール市場での差別化ポイントとして、以下の観点を意識すべき:

- **ローカルファースト**: データをユーザーの手元に保持する安心感（プライバシー重視）
- **シンプルさ**: 多機能化しすぎず、1on1 に特化した使いやすさを維持
- **準備 → 記録 → フォローアップ**: このワークフローをいかにスムーズにするかが鍵
- **マネージャーの負荷軽減**: 自動化・レコメンド・可視化でマネージャーの認知負荷を下げる
