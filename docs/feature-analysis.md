# Nudge 機能分析・改善提案書

## 1. 現状の機能分析

### 1.1 アプリケーション概要

Nudge は 1on1 ミーティングの記録・管理を行うシングルユーザー向けローカル Web アプリケーション。Next.js 16 (App Router) + React 19 + Prisma (SQLite) で構成され、メンバー管理、ミーティング記録、アクションアイテム管理を核とした機能を提供している。

### 1.2 現在実装されている機能

| 機能カテゴリ           | 機能                 | 概要                                                                                                                  |
| ---------------------- | -------------------- | --------------------------------------------------------------------------------------------------------------------- |
| **ダッシュボード**     | KPI カード           | 要フォロー人数、アクション完了率、今月の1on1回数、期限超過件数を表示                                                  |
|                        | メンバー一覧テーブル | ソート可能（最終1on1、未完了アクション数）、ステータスバッジ（良好/注意/要フォロー）付き                              |
| **メンバー管理**       | CRUD                 | 名前（必須）、部署、役職の登録・更新・削除                                                                            |
|                        | メンバー詳細         | アバター表示、1on1 履歴一覧、アクションアイテム一覧                                                                   |
| **ミーティング管理**   | 新規作成             | 日付、話題（カテゴリ + タイトル + ノート）、アクションアイテムを一括登録                                              |
|                        | 準備画面             | 前回のミーティング振り返り、未完了アクション確認、テンプレート選択、アジェンダ作成                                    |
|                        | ミーティング詳細     | 話題・アクションアイテムの閲覧                                                                                        |
|                        | テンプレート         | 定期チェックイン、キャリア面談、課題解決、フリーの4種                                                                 |
|                        | ドラッグ&ドロップ    | 話題の並び替え（dnd-kit、`sortOrder` で永続化）。アクションアイテムはフォーム内のみ並び替え可能（順序は DB 未永続化） |
| **アクションアイテム** | ステータス管理       | TODO / IN_PROGRESS / DONE のステータス遷移（クリックでサイクル、ドロップダウンで選択）                                |
|                        | フィルタリング       | ステータス別、メンバー別のフィルタリング                                                                              |
|                        | 期限管理             | 期限日の設定、期限超過の検出・表示                                                                                    |
| **UI/UX**              | レスポンシブ         | デスクトップ固定サイドバー、モバイルハンバーガーメニュー                                                              |
|                        | パンくずリスト       | 全ページに階層ナビゲーション                                                                                          |
|                        | アニメーション       | フェードイン、スライドイン等のマイクロインタラクション                                                                |
|                        | アバター             | 名前からイニシャル + 決定論的グラデーション生成                                                                       |

### 1.3 データモデル

```
Member (1) ──< (N) Meeting (1) ──< (N) Topic
   │                    │
   │                    └──< (N) ActionItem
   └──────────────────────────< (N) ActionItem
```

- **Member**: 名前、部署、役職
- **Meeting**: 日付、メンバー紐付け
- **Topic**: カテゴリ（5種）、タイトル、ノート、表示順
- **ActionItem**: タイトル、説明、ステータス（3種）、期限日、完了日

### 1.4 現状の強み

- **準備 → 記録の流れ**: ミーティング準備画面で前回の振り返り・未完了アクション確認 → テンプレート選択 → アジェンダ作成 → 記録というワークフローが確立されている
- **即時フィードバック**: KPI ダッシュボードで要フォロー状態・期限超過を一目で把握可能
- **シンプルな操作性**: アクションアイテムのステータスをワンクリックで変更できる
- **ドラッグ&ドロップ**: 話題の直感的な並び替え（`sortOrder` で永続化済み）

### 1.5 現状の課題

コードベースの調査により、以下の課題・不整合が確認された。

- [x] ~~**メンバー編集 UI の欠如**: `updateMember` Server Action は実装済みだが、呼び出す UI が存在しない~~ → `MemberEditDialog` として実装済み
- [x] ~~**削除確認ダイアログの欠如**: UI 上に削除ボタン・確認ダイアログがない~~ → `MeetingDeleteDialog` / `MemberDeleteDialog` として実装済み
- [x] ~~**ActionItem の並び順が未永続化**: フォーム上では dnd-kit による並び替え UI が存在するが、`ActionItem` モデルに `sortOrder` フィールドがなく、DB には順序が保存されない。保存後は `dueDate asc, createdAt desc` で表示される~~ → `sortOrder Int @default(0)` フィールド追加、DnD 並び替え後の順序を DB に永続化済み
- [x] ~~**ミーティング編集不可**: 作成後の修正・追記ができない。`updateMeeting` Server Action が存在しない~~ → `updateMeeting` Server Action + `MeetingDetailPageClient` 編集モードとして実装済み
- [x] ~~**サイレントエラー**: 一部の Server Action で `catch` ブロックがエラーを握りつぶしており、ユーザーにフィードバックがない~~ → `ActionResult<T>` パターンで統一、エラーを UI にフィードバック
- [x] ~~**エラー境界が未設定**: `error.tsx` / `not-found.tsx` がなく、ランタイムエラー時のフォールバック UI がない~~ → `error.tsx` / `not-found.tsx` を追加
- [x] ~~**操作フィードバックの不足**: トースト通知等がなく、保存成功・失敗のフィードバックが `router.push` によるページ遷移のみ~~ → sonner によるトースト通知を導入、全 CRUD 操作に成功/失敗フィードバックを追加

---

## 2. 改善提案

### 2.1 データ管理の改善

#### 2.1.1 ミーティングの編集機能 — 優先度: 高

- [x] ミーティング詳細画面に「編集」ボタンを追加 → `MeetingDetailPageClient` として実装済み
- [x] 話題の追加・削除・内容修正、アクションアイテムの追加・削除・内容修正を可能に → `MeetingForm` の `initialData` prop で対応
- [x] `updateMeeting` Server Action と `updateMeetingSchema` バリデーションの追加
- [x] 話題のノートのインライン編集 → `MeetingForm` 編集モードで対応

#### 2.1.2 メンバーの編集機能 — 優先度: 高

- [x] メンバー詳細画面に「編集」ボタンを追加 → `MemberEditDialog` として実装済み
- [x] メンバーフォームを新規登録と編集で共用化（`initialData` prop 追加） → `MemberForm` が `initialData` 対応済み
- [x] 部署変更や役職変更を UI から実行可能に

#### 2.1.3 アクションアイテムの編集機能 — 優先度: 中

- [x] アクションアイテムのインライン編集またはモーダル編集 → `ActionListFull` / `ActionListCompact` に行レベルインライン編集を追加
- [x] `updateActionItem` Server Action の追加
- [x] 期限の変更、説明の追記を可能に

#### 2.1.4 ミーティングの削除確認 — 優先度: 中

- [x] ミーティング詳細画面に「削除」ボタンを追加 → `MeetingDeleteDialog` として実装済み
- [x] 確認ダイアログ（shadcn/ui の AlertDialog）を使用して誤削除を防止
- [x] メンバー削除も同様の確認ダイアログを追加 → `MemberDeleteDialog` として実装済み

---

### 2.2 分析・可視化機能

#### 2.2.1 ミーティング頻度の可視化 — 優先度: 中

- [ ] メンバー別の1on1実施間隔をヒートマップまたはカレンダービューで表示
- [ ] 月ごとの実施回数のバーチャート（Recharts 等）
- [ ] ダッシュボードに「推奨: 今週1on1すべきメンバー」のレコメンド表示
- [ ] 新規ページ `src/app/analytics/page.tsx` の追加

#### 2.2.2 話題カテゴリの傾向分析 — 優先度: 低

- [x] メンバーごとに話題カテゴリの分布を円グラフまたはバーチャートで表示
- [x] 「キャリア相談が少ない」「課題ばかり」などの偏りを可視化
- [x] 時系列での話題カテゴリ変遷

#### 2.2.3 アクションアイテムの完了傾向 — 優先度: 低

- [x] メンバー別のアクション完了率推移のライングラフ
- [x] 平均完了日数の表示
- [x] 期限遵守率の可視化

---

### 2.3 ユーザビリティ改善

#### 2.3.1 検索機能 — 優先度: 高

- [x] グローバル検索バー（サイドバーまたはヘッダーに配置） → `GlobalSearch` コンポーネントとしてサイドバーに実装済み
- [x] 検索対象: メンバー名、話題タイトル、話題ノート、アクションアイテムタイトル → `searchAll` Server Action で対応
- [x] SQLite の LIKE ベースでの全文検索 → Prisma `contains` フィルターで実装
- [x] `Cmd+K` / `Ctrl+K` ショートカットでフォーカス → `useEffect` でキーリスナー実装済み
- [x] インクリメンタル検索結果をドロップダウンで表示 → 300ms デバウンス + グループ別ドロップダウン実装済み

#### 2.3.2 キーボードショートカット — 優先度: 低

- [ ] `n` — 新規メンバー追加
- [ ] `m` — 新規ミーティング作成（メンバー選択付き）
- [ ] `Cmd+K` — 検索
- [ ] `?` — ショートカット一覧表示

#### 2.3.3 トースト通知 — 優先度: 中

- [x] ミーティング保存成功、アクション完了などの操作フィードバック → sonner + `TOAST_MESSAGES` 定数で全操作に対応
- [x] shadcn/ui の `sonner` (toast) コンポーネントの導入 → `src/components/ui/sonner.tsx` + RootLayout に `<Toaster />` 配置

#### 2.3.4 空状態（Empty State）の改善 — 優先度: 低

- [ ] 各画面にイラストまたはアイコン付きの空状態メッセージ
- [ ] CTA（Call To Action）ボタンの強調
- [ ] 初回起動時のオンボーディング（メンバー登録 → 最初の1on1 記録への誘導）

---

### 2.4 新機能提案

#### 2.4.1 1on1 メモのリアルタイム記録モード — 優先度: 高

- [ ] ミーティング開始ボタンで「記録モード」に入る
- [ ] 話題ごとにノートをインライン入力
- [ ] 自動保存（debounce 500ms での定期保存、またはフォーカスアウト時保存）
- [ ] ミーティング終了ボタンで確定
- [ ] 所要時間の自動計測（`Meeting` モデルに `startedAt`, `endedAt` フィールド追加）

#### 2.4.2 定期ミーティングスケジュール — 優先度: 中

- [ ] メンバーごとに 1on1 の実施頻度（毎週 / 隔週 / 月1）を設定
- [ ] 次回推奨日の自動計算と表示
- [ ] ダッシュボードに「今週予定の1on1」セクションを追加
- [ ] `Member` モデルに `meetingFrequency` フィールド追加

#### 2.4.3 フィードバック / 感情トラッキング — 優先度: 中

- [ ] ミーティング終了時に感情スコア（1〜5 の emoji スケール）を記録
- [ ] メンバーの感情推移をトレンドグラフで可視化
- [ ] `Meeting` モデルに `mood` フィールド追加

#### 2.4.4 タグ / ラベル機能 — 優先度: 低

- [ ] 話題やアクションアイテムにカスタムタグを付与
- [ ] タグによるフィルタリング・検索
- [ ] よく使うタグの自動サジェスト
- [ ] `Tag` モデルの追加（多対多リレーション）

#### 2.4.5 ミーティングノートのエクスポート — 優先度: 低

- [ ] メンバーごとの1on1サマリーを Markdown / PDF でエクスポート
- [ ] 期間指定でのバルクエクスポート
- [ ] クリップボードへのコピー機能

#### 2.4.6 ミーティング実施リマインダー — 優先度: 低

- [ ] 設定した頻度を超えてミーティング未実施のメンバーについて、ダッシュボードで目立つアラートを表示
- [ ] ブラウザ通知（Notification API）での通知（オプション）

---

### 2.5 技術的改善

#### 2.5.1 楽観的更新（Optimistic Updates） — 優先度: 高

- [x] React 19 の `useOptimistic` フックを使用 → `action-list-compact.tsx`, `action-list-full.tsx`, `previous-meeting-sidebar.tsx` で実装済み
- [x] ステータス変更を即座に UI に反映し、サーバーエラー時にロールバック

#### 2.5.2 エラーハンドリングの統一 — 優先度: 中

- [x] `src/app/error.tsx` グローバルエラー境界の追加
- [x] `src/app/not-found.tsx` カスタム 404 ページの追加
- [x] トースト通知によるエラーフィードバック → sonner で実装済み
- [x] Server Action のエラーを型安全に返却する共通パターン（`ActionResult<T>`）の導入

#### 2.5.3 データベース最適化 — 優先度: 低

- [ ] N+1 クエリの最適化（現状は概ね適切）
- [ ] インデックスの見直し（`Topic.meetingId` + `sortOrder` の複合インデックスなど）
- [ ] ページネーションの導入

#### 2.5.4 テストカバレッジの拡充 — 優先度: 中

- [x] `action-list-full` のテスト追加
- [x] `action-list-compact` のテスト追加
- [x] `previous-meeting-sidebar` のテスト追加
- [x] `member-edit-dialog` のテスト追加
- [x] `member-delete-dialog` のテスト追加
- [x] `meeting-delete-dialog` のテスト追加
- [x] `member-form` のテスト追加
- [x] `action-filters` のテスト追加
- [x] `sidebar` のテスト追加
- [x] `breadcrumb` のテスト追加
- [ ] Playwright による E2E テストの導入
- [ ] カバレッジの CI 自動測定

#### 2.5.5 アクセシビリティ改善 — 優先度: 中

- [x] `action-list-compact.tsx` の `<button>` に適切な `aria-label` を追加 → 「{アイテム名}のステータスを{次のステータス}に変更」形式で実装済み
- [x] `previous-meeting-sidebar.tsx` の `<input type="checkbox">` に `aria-label` 追加 → 既に実装済みであることを確認
- [x] ドラッグ&ドロップ操作のスクリーンリーダー向け説明の追加 → `dnd-accessibility.ts` で日本語アナウンスメント実装、ドラッグハンドルに `aria-label` / `aria-roledescription` 追加
- [x] カラーコントラストの WCAG 2.1 AA 準拠確認 → 全色ペア（muted-fg:4.65, primary-fg:4.83, destructive:5.38, status-done:9.38 等）が AA 基準（4.5:1）を満たすことを確認

#### 2.5.6 ダークモード対応 — 優先度: 低

- [ ] OKLch ベースの CSS 変数にダークテーマ値を追加
- [ ] `prefers-color-scheme` メディアクエリによる自動切替
- [ ] 手動切替トグルの追加（サイドバーのフッター領域）

---

### 2.6 UX フロー改善

#### 2.6.1 メンバー詳細画面の情報密度向上 — 優先度: 中

- [x] 最終1on1からの経過日数を目立つ位置に表示 → `MemberStatsBar` に「最終1on1」カードとして表示
- [x] 未完了アクションの件数バッジ → `MemberStatsBar` に「未完了アクション」カード + `MemberQuickActions` セクションタイトル横のバッジ
- [x] 「クイックアクション」セクション（最近のアクションをその場で完了マーク可能） → `MemberQuickActions` コンポーネントとして実装済み
- [x] メンバーとの通算1on1回数の表示 → `MemberStatsBar` に「通算1on1」カードとして表示

#### 2.6.2 ダッシュボードの強化 — 優先度: 中

- [ ] 「最近のアクティビティ」タイムライン（直近の1on1記録、アクション完了のフィード）
- [ ] 「今日 / 今週のタスク」セクション（期限が近いアクションアイテム一覧）
- [ ] メンバーカードのクイックアクション（ダッシュボードから直接1on1を開始）

#### 2.6.3 ミーティング準備画面の改善 — 優先度: 中

- [ ] 前回のミーティングだけでなく、過去複数回のミーティングを参照可能に
- [ ] 前回の話題をワンクリックで今回のアジェンダにコピー
- [ ] アクションアイテムの進捗確認チェックリスト（準備画面で事前にステータスを更新可能）

---

## 3. 実装優先度マトリクス

| 優先度         | 機能                     | カテゴリ   | 状態     |
| -------------- | ------------------------ | ---------- | -------- |
| **P0（必須）** | ミーティング編集         | データ管理 | **完了** |
| **P0（必須）** | メンバー編集 UI          | データ管理 | **完了** |
| **P0（必須）** | 楽観的更新               | 技術改善   | **完了** |
| **P1（重要）** | 検索機能                 | UX         | **完了** |
| **P1（重要）** | トースト通知             | UX         | **完了** |
| **P1（重要）** | エラーハンドリング統一   | 技術改善   | **完了** |
| **P1（重要）** | リアルタイム記録モード   | 新機能     | 未着手   |
| **P1（重要）** | 削除確認ダイアログ       | UX         | **完了** |
| **P2（推奨）** | 定期スケジュール設定     | 新機能     | 未着手   |
| **P2（推奨）** | 感情トラッキング         | 新機能     | 未着手   |
| **P2（推奨）** | ミーティング頻度の可視化 | 分析       | 未着手   |
| **P2（推奨）** | アクションアイテム編集   | データ管理 | **完了** |
| **P2（推奨）** | テストカバレッジ拡充     | 技術改善   | 一部完了 |
| **P2（推奨）** | アクセシビリティ改善     | 技術改善   | **完了** |
| **P2（推奨）** | メンバー詳細情報密度向上 | UX         | **完了** |
| **P2（推奨）** | ダッシュボード強化       | UX         | 未着手   |
| **P2（推奨）** | 準備画面の改善           | UX         | 未着手   |
| **P3（将来）** | 話題カテゴリの傾向分析   | 分析       | **完了** |
| **P3（将来）** | タグ / ラベル機能        | 新機能     | 未着手   |
| **P3（将来）** | エクスポート機能         | 新機能     | 未着手   |
| **P3（将来）** | ダークモード             | 技術改善   | 未着手   |
| **P3（将来）** | ショートカットキー       | UX         | 未着手   |
| **P3（将来）** | 空状態の改善             | UX         | 未着手   |
| **P3（将来）** | DB 最適化                | 技術改善   | 未着手   |

---

## 4. 推奨する実装ロードマップ

### Phase 1: 基盤整備

- [x] ミーティング編集機能
- [x] メンバー編集 UI
- [x] 削除確認ダイアログ
- [x] エラーハンドリングの統一（error.tsx / not-found.tsx / ActionResult パターン）
- [x] トースト通知の導入

### Phase 2: 操作性向上

- [x] 楽観的更新の導入
- [x] アクションアイテム編集
- [x] 検索機能
- [ ] ダッシュボード強化

### Phase 3: 差別化機能

- [ ] リアルタイム記録モード
- [ ] 定期スケジュール設定
- [ ] 感情トラッキング
- [ ] ミーティング準備画面の改善

### Phase 4: 分析・拡張

- [ ] ミーティング頻度の可視化
- [x] 話題カテゴリの傾向分析
- [ ] エクスポート機能
- [ ] ダークモード

---

## 5. 補足: 競合分析の観点

1on1 ツール市場での差別化ポイントとして、以下の観点を意識すべき:

- **ローカルファースト**: データをユーザーの手元に保持する安心感（プライバシー重視）
- **シンプルさ**: 多機能化しすぎず、1on1 に特化した使いやすさを維持
- **準備 → 記録 → フォローアップ**: このワークフローをいかにスムーズにするかが鍵
- **マネージャーの負荷軽減**: 自動化・レコメンド・可視化でマネージャーの認知負荷を下げる
